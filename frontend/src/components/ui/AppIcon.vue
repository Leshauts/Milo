<!-- frontend/src/components/ui/AppIcon.vue -->
<template>
  <div 
    class="app-icon" 
    :style="iconStyle"
    :class="{ 'size-large': props.size === 'large' || props.size === 72 }"
  >
    <div class="app-icon-content">
      <div v-html="svgContent" class="app-icon-svg" />
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue';

// Props
const props = defineProps({
  name: { 
    type: String, 
    required: true,
    validator: (value) => ['bluetooth', 'spotify', 'roc', 'multiroom', 'equalizer' ].includes(value)
  },
  size: { 
    type: [String, Number], 
    default: 32
  }
});

// Générer un ID unique pour éviter les conflits de gradients SVG
const uniqueId = computed(() => `${props.name}-${Math.random().toString(36).substr(2, 9)}`);

// Icônes SVG intégrées - SANS width/height pour être scalables
const appIcons = {
  bluetooth: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 72 72"> <rect width="72" height="72" fill="#0046EB" rx="18"/> <path fill="#fff" d="M35.1 13.2a2 2 0 0 1 2.1.2l14 10.5a2 2 0 0 1 0 3.2L39.3 36l11.9 8.9a2 2 0 0 1 0 3.2l-14 10.5A2 2 0 0 1 34 57V40l-10.8 8.1a2 2 0 0 1-2.4-3.2L32.7 36l-11.9-8.9-.2-.1a2 2 0 0 1 2.4-3.2l.2.1L34 32V15a2 2 0 0 1 1.1-1.8ZM38 53l8.7-6.5L38 40v13Zm0-21 8.7-6.5L38 19v13Z"/> </svg>`,
  
  spotify: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 72 72"> <rect width="72" height="72" fill="#000" rx="18"/> <path fill="#1ED760" d="M36 8.875C21.027 8.875 8.875 21.027 8.875 36S21.027 63.125 36 63.125 63.125 50.973 63.125 36 50.973 8.875 36 8.875Z"/> <path fill="#000" d="M53.347 33.276c-.569 0-.919-.142-1.411-.426-7.788-4.649-21.711-5.764-30.724-3.248-.393.109-.885.284-1.41.284-1.444 0-2.549-1.127-2.549-2.581 0-1.488.919-2.33 1.903-2.614 3.85-1.127 8.16-1.663 12.852-1.663 7.984 0 16.351 1.663 22.465 5.228.854.492 1.411 1.17 1.411 2.472a2.534 2.534 0 0 1-2.537 2.548Zm-3.39 8.335c-.57 0-.952-.252-1.346-.46-6.836-4.046-17.03-5.676-26.097-3.215-.525.142-.81.284-1.302.284a2.124 2.124 0 0 1-2.121-2.122c0-1.17.568-1.947 1.695-2.264 3.04-.853 6.147-1.487 10.697-1.487 7.098 0 13.956 1.76 19.36 4.976.885.525 1.235 1.203 1.235 2.155-.01 1.181-.93 2.133-2.122 2.133Zm-2.943 7.175c-.46 0-.744-.142-1.17-.394-6.825-4.112-14.766-4.287-22.608-2.68-.427.11-.984.285-1.302.285-1.06 0-1.728-.842-1.728-1.728 0-1.127.668-1.663 1.488-1.838 8.958-1.98 18.112-1.804 25.922 2.866.667.426 1.06.81 1.06 1.805 0 .995-.776 1.684-1.662 1.684Z"/> </svg>`,
  
  roc: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 72 72"><rect width="72" height="72" fill="#1D1D1F" rx="18"/><path fill="#F7F7F7" fill-rule="evenodd" d="M25.74 52.74c5.04 0 8.195-3.812 8.195-9.867 0-6.079-3.156-9.89-8.196-9.89-5.04 0-8.194 3.811-8.194 9.889 0 6.035 3.154 9.868 8.194 9.868h.002Zm14.968-29.509a1.88 1.88 0 0 0 .254-.956v-.764l-2.202.149c-.873.06-1.406.294-1.647.705a1.22 1.22 0 0 0-.154.63c0 .846.7 1.312 1.674 1.312.932 0 1.698-.424 2.075-1.076Zm8.347 2.531c-2.626 0-4.236-1.78-4.236-4.702.002-2.857 1.61-4.637 4.236-4.615 2.266 0 3.621 1.313 3.854 3.049h-1.737c-.19-.867-.931-1.546-2.117-1.546-1.482 0-2.393 1.166-2.393 3.113 0 1.969.911 3.177 2.393 3.177 1.123 0 1.884-.529 2.118-1.504h1.736c-.233 1.78-1.63 3.028-3.854 3.028Zm-28.44-.17v-8.98l1.717-.02v1.44h.127c.38-1.016 1.29-1.61 2.496-1.61 1.23 0 2.077.636 2.479 1.61h.148c.445-.973 1.483-1.61 2.732-1.61 1.822 0 2.88 1.102 2.88 2.965v6.206h-1.778V19.83c0-1.25-.574-1.842-1.737-1.842-1.165 0-1.906.847-1.906 1.927v5.675h-1.737v-5.95c0-1.017-.677-1.652-1.737-1.652-1.08 0-1.905.931-1.905 2.096v5.506h-1.779Zm5.124 4.552c6.989 0 11.352 4.913 11.352 12.727 0 7.793-4.363 12.706-11.352 12.706-6.987.001-11.35-4.891-11.35-12.706 0-7.814 4.363-12.727 11.352-12.727h-.002Zm15.163-5.824c-.551.912-1.524 1.419-2.711 1.419-1.736 0-3.006-1.037-2.986-2.647 0-1.63 1.207-2.562 3.347-2.689l2.435-.148v-.784c0-.995-.635-1.546-1.842-1.546-.996 0-1.694.36-1.886 1.017h-1.714c.191-1.502 1.631-2.498 3.684-2.498 2.266 0 3.537 1.122 3.537 3.007v6.14h-1.715v-1.27h-.149Zm9.551 17.196c5.125 1.122 7.158 3.156 7.158 6.649 0 4.553-3.579 7.412-9.064 7.412-5.378 0-8.958-2.753-9.254-7.008h3.07c.36 2.645 2.816 4.255 6.353 4.255 3.325 0 5.76-1.758 5.76-4.172 0-2.055-1.377-3.43-4.785-4.172l-2.732-.593c-4.934-1.08-7.074-3.324-7.074-6.818 0-4.045 3.58-6.904 8.683-6.904 4.913 0 8.449 2.944 8.597 7.115h-3.07c-.276-2.711-2.393-4.361-5.611-4.361-3.072 0-5.443 1.503-5.443 4.001 0 1.927 1.313 3.262 4.68 4.003l2.732.593Z" clip-rule="evenodd"/></svg>`,

  multiroom: `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 72 72"> <rect width="72" height="72" fill="url(#GRADIENT_ID)" rx="18"/> <path fill="#fff" d="M40.75 36c0-2.6234-2.1266-4.75-4.75-4.75s-4.75 2.1266-4.75 4.75 2.1266 4.75 4.75 4.75 4.75-2.1266 4.75-4.75Zm4 0c0 4.8325-3.9175 8.75-8.75 8.75s-8.75-3.9175-8.75-8.75 3.9175-8.75 8.75-8.75 8.75 3.9175 8.75 8.75Z" opacity=".95"/> <path fill="#fff" d="M23.1904 24.5415c.737-.8227 2.0015-.8923 2.8242-.1553.8224.737.892 2.0006.1553 2.8233a13.1765 13.1765 0 0 0-3.3613 8.791 13.1764 13.1764 0 0 0 2.9668 8.3291l.3945.4619.1289.1592c.5962.8194.4869 1.9732-.2842 2.664-.8226.7367-2.0872.6673-2.8242-.1552a17.176 17.176 0 0 1-4.3818-11.459 17.176 17.176 0 0 1 4.3818-11.459Zm22.7979-.1553c.8227-.7369 2.0862-.6674 2.8232.1553a17.1752 17.1752 0 0 1 4.3828 11.459 17.1757 17.1757 0 0 1-4.3828 11.459c-.7369.8224-2.0006.8919-2.8232.1552-.8227-.7369-.892-2.0004-.1553-2.8232a13.1765 13.1765 0 0 0 0-17.582c-.7369-.8227-.6672-2.0863.1553-2.8233Z" opacity=".7"/> <path fill="#fff" d="M51.4736 18.04c.7389-.7254 1.8981-.761 2.6778-.1132l.1504.1386.4345.4541A25.6003 25.6003 0 0 1 61.6348 36a25.601 25.601 0 0 1-7.333 17.9346c-.7739.7879-2.04.8-2.8282.0263-.7882-.7738-.7992-2.0409-.0254-2.8291A21.5998 21.5998 0 0 0 57.6348 36a21.6007 21.6007 0 0 0-5.8203-14.749l-.3663-.3828-.1367-.1534c-.6332-.7912-.5764-1.9493.1621-2.6748Zm-33.624-.1132c.7796-.6481 1.9388-.6123 2.6777.1132.7882.7739.8002 2.04.0264 2.8282l-.3662.3828A21.599 21.599 0 0 0 14.3672 36a21.5995 21.5995 0 0 0 6.1865 15.1318c.7738.7882.7618 2.0553-.0264 2.8291-.739.7252-1.8982.7603-2.6777.1123l-.1504-.1386-.4346-.4532A25.6003 25.6003 0 0 1 10.3672 36a25.6 25.6 0 0 1 7.332-17.9346l.1504-.1386Z" opacity=".4"/> <defs> <linearGradient id="GRADIENT_ID" x1="36" x2="36" y1="0" y2="72" gradientUnits="userSpaceOnUse"> <stop stop-color="#EF642E"/> <stop offset="1" stop-color="#EC571D"/> </linearGradient> </defs> </svg>`,

  equalizer: `<svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 72 72" fill="none"> <g clip-path="url(#CLIP_PATH_ID)"> <path d="M54 0H18C8.05887 0 0 8.05887 0 18V54C0 63.9411 8.05887 72 18 72H54C63.9411 72 72 63.9411 72 54V18C72 8.05887 63.9411 0 54 0Z" fill="url(#BG_GRADIENT_ID)"/> <path d="M21.4 16.1C21.9304 16.1 22.4391 16.3107 22.8142 16.6858C23.1893 17.0608 23.4 17.5695 23.4 18.1V31.1C24.7768 31.556 25.9749 32.4344 26.8241 33.6102C27.6733 34.7861 28.1303 36.1996 28.1303 37.65C28.1303 39.1004 27.6733 40.5139 26.8241 41.6897C25.9749 42.8656 24.7768 43.7439 23.4 44.2V53.9C23.4 54.4304 23.1893 54.9391 22.8142 55.3142C22.4391 55.6893 21.9304 55.9 21.4 55.9C20.8696 55.9 20.3608 55.6893 19.9858 55.3142C19.6107 54.9391 19.4 54.4304 19.4 53.9V44.2C17.9857 43.7687 16.7473 42.8946 15.8674 41.7063C14.9874 40.5181 14.5125 39.0786 14.5125 37.6C14.5125 36.1214 14.9874 34.6819 15.8674 33.4936C16.7473 32.3054 17.9857 31.4312 19.4 31V18.1C19.4 17.1 20.3 16.1 21.4 16.1ZM36 16.1C36.5304 16.1 37.0391 16.3107 37.4142 16.6858C37.7893 17.0608 38 17.5695 38 18.1V21.3C39.4143 21.7312 40.6527 22.6054 41.5326 23.7936C42.4126 24.9819 42.8875 26.4214 42.8875 27.9C42.8875 29.3786 42.4126 30.8181 41.5326 32.0063C40.6527 33.1946 39.4143 34.0687 38 34.5V53.9C38 54.4304 37.7893 54.9391 37.4142 55.3142C37.0391 55.6893 36.5304 55.9 36 55.9C35.4696 55.9 34.9608 55.6893 34.5858 55.3142C34.2107 54.9391 34 54.4304 34 53.9V34.5C32.5857 34.0687 31.3473 33.1946 30.4674 32.0063C29.5874 30.8181 29.1125 29.3786 29.1125 27.9C29.1125 26.4214 29.5874 24.9819 30.4674 23.7936C31.3473 22.6054 32.5857 21.7312 34 21.3V18.1C34 17.1 34.9 16.1 36 16.1ZM50.6 16.1C51.1304 16.1 51.6391 16.3107 52.0142 16.6858C52.3893 17.0608 52.6 17.5695 52.6 18.1V37.5C54.0143 37.9312 55.2527 38.8054 56.1326 39.9936C57.0126 41.1819 57.4875 42.6214 57.4875 44.1C57.4875 45.5786 57.0126 47.0181 56.1326 48.2063C55.2527 49.3946 54.0143 50.2687 52.6 50.7V53.9C52.6 54.4304 52.3893 54.9391 52.0142 55.3142C51.6391 55.6893 51.1304 55.9 50.6 55.9C50.0696 55.9 49.5608 55.6893 49.1858 55.3142C48.8107 54.9391 48.6 54.4304 48.6 53.9V50.7C47.1857 50.2687 45.9473 49.3946 45.0674 48.2063C44.1874 47.0181 43.7125 45.5786 43.7125 44.1C43.7125 42.6214 44.1874 41.1819 45.0674 39.9936C45.9473 38.8054 47.1857 37.9312 48.6 37.5V18.1C48.6 17.1 49.6 16.1 50.6 16.1ZM50.6 41.2C50.2192 41.2 49.8421 41.275 49.4902 41.4207C49.1384 41.5665 48.8187 41.7801 48.5494 42.0494C48.2801 42.3187 48.0665 42.6384 47.9207 42.9902C47.775 43.342 47.7 43.7191 47.7 44.1C47.7 44.4808 47.775 44.8579 47.9207 45.2098C48.0665 45.5616 48.2801 45.8813 48.5494 46.1506C48.8187 46.4199 49.1384 46.6335 49.4902 46.7792C49.8421 46.925 50.2192 47 50.6 47C51.3691 47 52.1067 46.6944 52.6506 46.1506C53.1945 45.6067 53.5 44.8691 53.5 44.1C53.5 43.3308 53.1945 42.5932 52.6506 42.0494C52.1067 41.5055 51.3691 41.2 50.6 41.2ZM21.4 34.7C20.6309 34.7 19.8932 35.0055 19.3494 35.5494C18.8055 36.0932 18.5 36.8308 18.5 37.6C18.5 38.3691 18.8055 39.1067 19.3494 39.6506C19.8932 40.1944 20.6309 40.5 21.4 40.5C22.1691 40.5 22.9067 40.1944 23.4506 39.6506C23.9945 39.1067 24.3 38.3691 24.3 37.6C24.3 36.8308 23.9945 36.0932 23.4506 35.5494C22.9067 35.0055 22.1691 34.7 21.4 34.7ZM36 25C35.2309 25 34.4932 25.3055 33.9494 25.8494C33.4055 26.3932 33.1 27.1308 33.1 27.9C33.1 28.6691 33.4055 29.4067 33.9494 29.9506C34.4932 30.4944 35.2309 30.8 36 30.8C36.7691 30.8 37.5067 30.4944 38.0506 29.9506C38.5945 29.4067 38.9 28.6691 38.9 27.9C38.9 27.1308 38.5945 26.3932 38.0506 25.8494C37.5067 25.3055 36.7691 25 36 25Z" fill="url(#TEXT_GRADIENT_ID)"/> </g> <defs> <linearGradient id="BG_GRADIENT_ID" x1="36" y1="0" x2="36" y2="72" gradientUnits="userSpaceOnUse"> <stop stop-color="#393E3B"/> <stop offset="1" stop-color="#1D201E"/> </linearGradient> <linearGradient id="TEXT_GRADIENT_ID" x1="36" y1="16.1" x2="36" y2="55.9" gradientUnits="userSpaceOnUse"> <stop stop-color="white"/> <stop offset="1" stop-color="#C7D6E5"/> </linearGradient> <clipPath id="CLIP_PATH_ID"> <rect width="72" height="72" fill="white"/> </clipPath> </defs> </svg>`,
};

// Fonction pour remplacer les IDs de gradients par l'ID unique
function makeGradientsUnique(svgString, uniqueId) {
  // Pour multiroom - remplacer le gradient ID
  if (svgString.includes('GRADIENT_ID')) {
    return svgString.replace(/GRADIENT_ID/g, `multiroom-gradient-${uniqueId}`);
  }
  
  // Pour equalizer - remplacer tous les IDs
  if (svgString.includes('BG_GRADIENT_ID')) {
    return svgString
      .replace(/BG_GRADIENT_ID/g, `eq-bg-${uniqueId}`)
      .replace(/TEXT_GRADIENT_ID/g, `eq-text-${uniqueId}`)
      .replace(/CLIP_PATH_ID/g, `eq-clip-${uniqueId}`);
  }
  
  return svgString;
}

// Style computed avec taille forcée
const iconStyle = computed(() => {
  let sizeInPx = 32; // Default
  
  if (typeof props.size === 'number') {
    sizeInPx = props.size;
  } else if (typeof props.size === 'string') {
    switch (props.size) {
      case 'large': sizeInPx = 72; break;
      case 'medium': sizeInPx = 64; break;
      case 'small': sizeInPx = 32; break;
      default: sizeInPx = 32;
    }
  }
  
  return {
    width: `${sizeInPx}px`,
    height: `${sizeInPx}px`,
    '--icon-size': `${sizeInPx}px`
  };
});

// Contenu SVG avec gradients uniques
const svgContent = computed(() => {
  const icon = appIcons[props.name];
  if (!icon) {
    console.warn(`AppIcon "${props.name}" not found`);
    return '';
  }
  
  // Appliquer les IDs uniques pour les icônes avec gradients
  return makeGradientsUnique(icon, uniqueId.value);
});
</script>

<style scoped>
.app-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  border-radius: var(--radius-02);
  overflow: hidden;
  /* Force la taille via les variables CSS */
  width: var(--icon-size);
  height: var(--icon-size);
}

.app-icon-content {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

.app-icon-svg {
  display: block;
  width: 100%;
  height: 100%;
}

.app-icon-svg :deep(svg) {
  width: 100% !important;
  height: 100% !important;
  display: block;
}

/* Mobile responsive - Override taille large */
@media (max-aspect-ratio: 4/3) {
  .app-icon.size-large {
    width: 64px !important;
    height: 64px !important;
    --icon-size: 64px;
  }
}
</style>